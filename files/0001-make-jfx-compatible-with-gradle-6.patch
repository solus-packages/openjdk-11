From 460e4b0bb86616a928b3521bc4cdac83ea3860ee Mon Sep 17 00:00:00 2001
From: Campbell Jones <git@serebit.com>
Date: Thu, 19 Nov 2020 14:17:09 -0500
Subject: [PATCH] make jfx compatible with gradle 6

---
 build.gradle    | 14 ++++++++++++--
 settings.gradle |  4 ----
 2 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/build.gradle b/build.gradle
index 92d4efdc..8c67930c 100644
--- a/build.gradle
+++ b/build.gradle
@@ -426,7 +426,7 @@ defineProperty("BUILD_TOOLS_DOWNLOAD_SCRIPT", "")
 ext.SWT_FILE_NAME = IS_MAC ? "org.eclipse.swt.cocoa.macosx.x86_64_3.105.3.v20170228-0512" :
     IS_WINDOWS && IS_64 ? "org.eclipse.swt.win32.win32.x86_64_3.105.3.v20170228-0512" :
     IS_WINDOWS && !IS_64 ? "org.eclipse.swt.win32.win32.x86_3.105.3.v20170228-0512" :
-    IS_LINUX && IS_64 ? "org.eclipse.swt.gtk.linux.x86_64_3.105.3.v20170228-0512" :
+    IS_LINUX && IS_64 ? "org.eclipse.platform:org.eclipse.swt.gtk.linux.x86_64:3.115.0" :
     IS_LINUX && !IS_64 ? "org.eclipse.swt.gtk.linux.x86_3.105.3.v20170228-0512" : ""
 
 // Specifies whether to run full tests (true) or smoke tests (false)
@@ -1817,6 +1817,16 @@ allprojects {
     apply plugin: "java"
     sourceCompatibility = 10
 
+    configurations.all {
+        resolutionStrategy {
+            dependencySubstitution {
+                // The maven property ${osgi.platform} is not handled by Gradle
+                // so we replace the dependency, using the osgi platform from the project settings
+                substitute module('org.eclipse.platform:org.eclipse.swt.${osgi.platform}') with module("org.eclipse.platform:org.eclipse.swt.gtk.linux.x86_64:3.115.0")
+            }
+        }
+    }
+
     // By default all of our projects require junit for testing so we can just
     // setup this dependency here.
     dependencies {
@@ -2515,7 +2525,7 @@ project(":swt") {
     commonModuleSetup(project, [ 'base', 'graphics' ])
 
     dependencies {
-        compile name: SWT_FILE_NAME
+        compile SWT_FILE_NAME
     }
 
     classes {
diff --git a/settings.gradle b/settings.gradle
index f37f4cf1..ff85193b 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -37,10 +37,6 @@ project(":web").projectDir = file("modules/javafx.web")
 project(":media").projectDir = file("modules/javafx.media")
 project(":systemTests").projectDir = file("tests/system")
 
-// Stable publishing behavior is the default in gradle 5.x.
-// This setting enables it in gradle 4.8 to help with the transition.
-enableFeaturePreview('STABLE_PUBLISHING')
-
 def closedDir = file("../rt-closed")
 def buildClosed = closedDir.isDirectory()
 
-- 
2.29.2

